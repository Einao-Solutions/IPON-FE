import{s as Le,l as Ae,m as je,k as Me,d,w as Pe,a as G,i as y,b as h,o as b,c as w,e as D,g as j,f as H,h as k,j as P,t as O,W as He,X as Oe,y as ke,A as ve,n as Ie}from"./qLIpCCSV.js";import{S as Re,i as qe,b as Be,d as F,t as N,a as E,m as U,e as L,f as M,g as me,c as pe}from"./Bpqo0lwe.js";import{e as _e}from"./Dvl1x7Q7.js";import{L as ce}from"./Bw5Z8-RE.js";import{b as Ee,T as ge}from"./DvhB1z8p.js";import"./BjHBLxYU.js";import{T as ze}from"./BH7uzI8L.js";import{R as Je}from"./VnMGUFCn.js";import"./B7ETfSbN.js";import{I as We}from"./yUtJ0l37.js";import{c as re}from"./CqGyily1.js";import{t as Te}from"./C8fCgc2Z.js";import{T as Xe}from"./C70sWgzc.js";import{l as Ge}from"./WlDbmOKK.js";import{I as Fe}from"./DxaiNGYP.js";import{S as Ke}from"./DEkAVRth.js";import{S as Qe}from"./DY3WZk6Z.js";import{B as Ye}from"./Amalccm3.js";function Ce(r,e,t){const l=r.slice();return l[12]=e[t],l}function De(r,e,t){const l=r.slice();return l[15]=e[t],l}function Ze(r){let e;return{c(){e=O("Created by")},l(t){e=H(t,"Created by")},m(t,l){y(t,e,l)},d(t){t&&d(e)}}}function xe(r){let e;return{c(){e=O("Status")},l(t){e=H(t,"Status")},m(t,l){y(t,e,l)},d(t){t&&d(e)}}}function et(r){let e;return{c(){e=O("Date Created")},l(t){e=H(t,"Date Created")},m(t,l){y(t,e,l)},d(t){t&&d(e)}}}function tt(r){let e;return{c(){e=O("Title")},l(t){e=H(t,"Title")},m(t,l){y(t,e,l)},d(t){t&&d(e)}}}function Se(r){let e,t,l,f;e=new ce({props:{$$slots:{default:[at]},$$scope:{ctx:r}}});let s=_e(r[0].affectedFiles),a=[];for(let n=0;n<s.length;n+=1)a[n]=Ne(De(r,s,n));return{c(){M(e.$$.fragment),t=P(),l=k("div");for(let n=0;n<a.length;n+=1)a[n].c();this.h()},l(n){L(e.$$.fragment,n),t=j(n),l=w(n,"DIV",{class:!0});var i=D(l);for(let _=0;_<a.length;_+=1)a[_].l(i);i.forEach(d),this.h()},h(){b(l,"class","grid grid-cols-2 text-sm")},m(n,i){U(e,n,i),y(n,t,i),y(n,l,i);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(l,null);f=!0},p(n,i){const _={};if(i&262144&&(_.$$scope={dirty:i,ctx:n}),e.$set(_),i&1){s=_e(n[0].affectedFiles);let u;for(u=0;u<s.length;u+=1){const g=De(n,s,u);a[u]?a[u].p(g,i):(a[u]=Ne(g),a[u].c(),a[u].m(l,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=s.length}},i(n){f||(E(e.$$.fragment,n),f=!0)},o(n){N(e.$$.fragment,n),f=!1},d(n){n&&(d(t),d(l)),F(e,n),Pe(a,n)}}}function at(r){let e;return{c(){e=O("Affected Files")},l(t){e=H(t,"Affected Files")},m(t,l){y(t,e,l)},d(t){t&&d(e)}}}function Ne(r){let e,t=r[15].fileNumber+"",l,f;return{c(){e=k("a"),l=O(t),this.h()},l(s){e=w(s,"A",{class:!0,href:!0});var a=D(e);l=H(a,t),a.forEach(d),this.h()},h(){b(e,"class","p-1 m-1 border rounded-md"),b(e,"href",f="/dataview?id="+r[15].id)},m(s,a){y(s,e,a),h(e,l)},p(s,a){a&1&&t!==(t=s[15].fileNumber+"")&&G(l,t),a&1&&f!==(f="/dataview?id="+s[15].id)&&b(e,"href",f)},d(s){s&&d(e)}}}function Ve(r){let e,t,l,f;return t=new Fe({props:{icon:"typcn:attachment-outline",width:"1.2rem",height:"1.2rem"}}),{c(){e=k("a"),M(t.$$.fragment),this.h()},l(s){e=w(s,"A",{target:!0,href:!0});var a=D(e);L(t.$$.fragment,a),a.forEach(d),this.h()},h(){b(e,"target","_blank"),b(e,"href",l=r[12].attachment)},m(s,a){y(s,e,a),U(t,e,null),f=!0},p(s,a){(!f||a&1&&l!==(l=s[12].attachment))&&b(e,"href",l)},i(s){f||(E(t.$$.fragment,s),f=!0)},o(s){N(t.$$.fragment,s),f=!1},d(s){s&&d(e),F(t)}}}function ye(r){let e,t,l,f=r[12].message+"",s,a,n=re(r[12].dateAdded)+"",i,_,u,g,V=r[12].senderName+"",I,T,c,$,m=r[12].attachment&&Ve(r);return{c(){e=k("div"),t=k("div"),l=new Oe(!1),s=P(),a=k("p"),i=O(n),_=P(),u=k("div"),g=k("p"),I=O(V),T=P(),m&&m.c(),this.h()},l(v){e=w(v,"DIV",{class:!0});var S=D(e);t=w(S,"DIV",{class:!0});var J=D(t);l=He(J,!1),J.forEach(d),s=j(S),a=w(S,"P",{class:!0});var K=D(a);i=H(K,n),K.forEach(d),_=j(S),u=w(S,"DIV",{class:!0});var z=D(u);g=w(z,"P",{class:!0});var q=D(g);I=H(q,V),q.forEach(d),T=j(z),m&&m.l(z),z.forEach(d),S.forEach(d),this.h()},h(){l.a=null,b(t,"class","content"),b(a,"class","mt-2 opacity-60 text-sm"),b(g,"class","opacity-50 text-sm"),b(u,"class","flex justify-between"),b(e,"class",c="p-2 m-2 rounded-md "+(r[12].senderId===r[0].creatorId?"bg-green-300":"bg-gray-300")+" "+(r[12].senderId===r[0].creatorId?"justify-end":"justify-start"))},m(v,S){y(v,e,S),h(e,t),l.m(f,t),h(e,s),h(e,a),h(a,i),h(e,_),h(e,u),h(u,g),h(g,I),h(u,T),m&&m.m(u,null),$=!0},p(v,S){(!$||S&1)&&f!==(f=v[12].message+"")&&l.p(f),(!$||S&1)&&n!==(n=re(v[12].dateAdded)+"")&&G(i,n),(!$||S&1)&&V!==(V=v[12].senderName+"")&&G(I,V),v[12].attachment?m?(m.p(v,S),S&1&&E(m,1)):(m=Ve(v),m.c(),E(m,1),m.m(u,null)):m&&(me(),N(m,1,1,()=>{m=null}),pe()),(!$||S&1&&c!==(c="p-2 m-2 rounded-md "+(v[12].senderId===v[0].creatorId?"bg-green-300":"bg-gray-300")+" "+(v[12].senderId===v[0].creatorId?"justify-end":"justify-start")))&&b(e,"class",c)},i(v){$||(E(m),$=!0)},o(v){N(m),$=!1},d(v){v&&d(e),m&&m.d()}}}function lt(r){let e,t,l="<p>Ticket closed, comments can&#39;t be added</p>",f,s,a,n=r[0].resolution.staffName+"",i,_,u,g=re(r[0].resolution.date)+"",V;return{c(){e=k("div"),t=k("div"),t.innerHTML=l,f=P(),s=k("p"),a=O("Closed by "),i=O(n),_=P(),u=k("p"),V=O(g),this.h()},l(I){e=w(I,"DIV",{class:!0});var T=D(e);t=w(T,"DIV",{class:!0,"data-svelte-h":!0}),ve(t)!=="svelte-16uw9v1"&&(t.innerHTML=l),f=j(T),s=w(T,"P",{class:!0});var c=D(s);a=H(c,"Closed by "),i=H(c,n),c.forEach(d),_=j(T),u=w(T,"P",{class:!0});var $=D(u);V=H($,g),$.forEach(d),T.forEach(d),this.h()},h(){b(t,"class","flex justify-center w-full items-center"),b(s,"class","mt-2"),b(u,"class","text-sm font-light"),b(e,"class","flex flex-col w-full")},m(I,T){y(I,e,T),h(e,t),h(e,f),h(e,s),h(s,a),h(s,i),h(e,_),h(e,u),h(u,V)},p(I,T){T&1&&n!==(n=I[0].resolution.staffName+"")&&G(i,n),T&1&&g!==(g=re(I[0].resolution.date)+"")&&G(V,g)},i:Ie,o:Ie,d(I){I&&d(e)}}}function st(r){let e,t,l,f,s,a,n="attachment (optional)",i,_,u,g,V;function I(c){r[6](c)}let T={class:"min-h-16 mt-2",placeholder:"Enter text"};return r[2]!==void 0&&(T.value=r[2]),t=new ze({props:T}),Ae.push(()=>Be(t,"value",I)),_=new We({props:{id:"picture",type:"file",class:"mt-3",accept:".pdf, .jpg, .png, .jpeg",multiple:!1}}),_.$on("change",r[7]),g=new Ye({props:{$$slots:{default:[rt]},$$scope:{ctx:r}}}),g.$on("click",r[8]),{c(){e=k("div"),M(t.$$.fragment),f=P(),s=k("div"),a=k("p"),a.textContent=n,i=P(),M(_.$$.fragment),u=P(),M(g.$$.fragment),this.h()},l(c){e=w(c,"DIV",{});var $=D(e);L(t.$$.fragment,$),f=j($),s=w($,"DIV",{class:!0});var m=D(s);a=w(m,"P",{class:!0,"data-svelte-h":!0}),ve(a)!=="svelte-mf66d6"&&(a.textContent=n),i=j(m),L(_.$$.fragment,m),u=j(m),L(g.$$.fragment,m),m.forEach(d),$.forEach(d),this.h()},h(){b(a,"class","opacity-50 text-sm"),b(s,"class","flex gap-2 mt-1 items-center")},m(c,$){y(c,e,$),U(t,e,null),h(e,f),h(e,s),h(s,a),h(s,i),U(_,s,null),h(s,u),U(g,s,null),V=!0},p(c,$){const m={};!l&&$&4&&(l=!0,m.value=c[2],je(()=>l=!1)),t.$set(m);const v={};$&262152&&(v.$$scope={dirty:$,ctx:c}),g.$set(v)},i(c){V||(E(t.$$.fragment,c),E(_.$$.fragment,c),E(g.$$.fragment,c),V=!0)},o(c){N(t.$$.fragment,c),N(_.$$.fragment,c),N(g.$$.fragment,c),V=!1},d(c){c&&d(e),F(t),F(_),F(g)}}}function rt(r){let e,t,l,f="Send",s;return e=new Fe({props:{class:r[3]?"":"hidden",icon:"line-md:loading-loop",width:"1.2rem",height:"1.2rem"}}),{c(){M(e.$$.fragment),t=P(),l=k("p"),l.textContent=f},l(a){L(e.$$.fragment,a),t=j(a),l=w(a,"P",{"data-svelte-h":!0}),ve(l)!=="svelte-my8s8q"&&(l.textContent=f)},m(a,n){U(e,a,n),y(a,t,n),y(a,l,n),s=!0},p(a,n){const i={};n&8&&(i.class=a[3]?"":"hidden"),e.$set(i)},i(a){s||(E(e.$$.fragment,a),s=!0)},o(a){N(e.$$.fragment,a),s=!1},d(a){a&&(d(t),d(l)),F(e,a)}}}function nt(r){let e,t,l,f;const s=[st,lt],a=[];function n(i,_){return i[0].status!==ge.closed?0:1}return e=n(r),t=a[e]=s[e](r),{c(){t.c(),l=ke()},l(i){t.l(i),l=ke()},m(i,_){a[e].m(i,_),y(i,l,_),f=!0},p(i,_){let u=e;e=n(i),e===u?a[e].p(i,_):(me(),N(a[u],1,1,()=>{a[u]=null}),pe(),t=a[e],t?t.p(i,_):(t=a[e]=s[e](i),t.c()),E(t,1),t.m(l.parentNode,l))},i(i){f||(E(t),f=!0)},o(i){N(t),f=!1},d(i){i&&d(l),a[e].d(i)}}}function ot(r){let e,t,l,f,s,a,n=r[0].creatorName+"",i,_,u,g,V,I,T,c,$,m,v,S,J=re(r[0].created)+"",K,z,q,W,$e,te,ae,ne=r[0].title+"",ue,de,le,se,X,Q;l=new ce({props:{for:"creator",$$slots:{default:[Ze]},$$scope:{ctx:r}}}),g=new ce({props:{for:"status",$$slots:{default:[xe]},$$scope:{ctx:r}}}),I=new Xe({props:{state:r[0].status}}),$=new ce({props:{for:"creationdate",$$slots:{default:[et]},$$scope:{ctx:r}}}),W=new ce({props:{for:"title",$$slots:{default:[tt]},$$scope:{ctx:r}}});let A=r[0].affectedFiles&&Se(r),Y=_e(r[0].correspondences),C=[];for(let o=0;o<Y.length;o+=1)C[o]=ye(Ce(r,Y,o));const Ue=o=>N(C[o],1,1,()=>{C[o]=null});return X=new Qe({props:{$$slots:{default:[nt]},$$scope:{ctx:r}}}),{c(){e=k("div"),t=k("div"),M(l.$$.fragment),f=P(),s=k("div"),a=k("p"),i=O(n),_=P(),u=k("div"),M(g.$$.fragment),V=P(),M(I.$$.fragment),T=P(),c=k("div"),M($.$$.fragment),m=P(),v=k("div"),S=k("p"),K=O(J),z=P(),q=k("div"),M(W.$$.fragment),$e=P(),te=k("div"),ae=k("p"),ue=O(ne),de=P(),A&&A.c(),le=P();for(let o=0;o<C.length;o+=1)C[o].c();se=P(),M(X.$$.fragment),this.h()},l(o){e=w(o,"DIV",{class:!0});var p=D(e);t=w(p,"DIV",{});var R=D(t);L(l.$$.fragment,R),f=j(R),s=w(R,"DIV",{id:!0,class:!0});var oe=D(s);a=w(oe,"P",{class:!0});var ie=D(a);i=H(ie,n),ie.forEach(d),oe.forEach(d),R.forEach(d),_=j(p),u=w(p,"DIV",{});var Z=D(u);L(g.$$.fragment,Z),V=j(Z),L(I.$$.fragment,Z),Z.forEach(d),T=j(p),c=w(p,"DIV",{});var x=D(c);L($.$$.fragment,x),m=j(x),v=w(x,"DIV",{id:!0,class:!0});var fe=D(v);S=w(fe,"P",{class:!0});var B=D(S);K=H(B,J),B.forEach(d),fe.forEach(d),x.forEach(d),p.forEach(d),z=j(o),q=w(o,"DIV",{});var ee=D(q);L(W.$$.fragment,ee),$e=j(ee),te=w(ee,"DIV",{id:!0});var be=D(te);ae=w(be,"P",{class:!0});var we=D(ae);ue=H(we,ne),we.forEach(d),be.forEach(d),ee.forEach(d),de=j(o),A&&A.l(o),le=j(o);for(let he=0;he<C.length;he+=1)C[he].l(o);se=j(o),L(X.$$.fragment,o),this.h()},h(){b(a,"class","text-sm"),b(s,"id","creator"),b(s,"class","border rounded-md flex"),b(S,"class","text-sm"),b(v,"id","creationdate"),b(v,"class","border rounded-md flex"),b(e,"class","grid gap-4 sm:grid-cols-3 grid-cols-2 border rounded-md m-1 p-1"),b(ae,"class","p-2 border rounded-md"),b(te,"id","title")},m(o,p){y(o,e,p),h(e,t),U(l,t,null),h(t,f),h(t,s),h(s,a),h(a,i),h(e,_),h(e,u),U(g,u,null),h(u,V),U(I,u,null),h(e,T),h(e,c),U($,c,null),h(c,m),h(c,v),h(v,S),h(S,K),y(o,z,p),y(o,q,p),U(W,q,null),h(q,$e),h(q,te),h(te,ae),h(ae,ue),y(o,de,p),A&&A.m(o,p),y(o,le,p);for(let R=0;R<C.length;R+=1)C[R]&&C[R].m(o,p);y(o,se,p),U(X,o,p),Q=!0},p(o,p){const R={};p&262144&&(R.$$scope={dirty:p,ctx:o}),l.$set(R),(!Q||p&1)&&n!==(n=o[0].creatorName+"")&&G(i,n);const oe={};p&262144&&(oe.$$scope={dirty:p,ctx:o}),g.$set(oe);const ie={};p&1&&(ie.state=o[0].status),I.$set(ie);const Z={};p&262144&&(Z.$$scope={dirty:p,ctx:o}),$.$set(Z),(!Q||p&1)&&J!==(J=re(o[0].created)+"")&&G(K,J);const x={};if(p&262144&&(x.$$scope={dirty:p,ctx:o}),W.$set(x),(!Q||p&1)&&ne!==(ne=o[0].title+"")&&G(ue,ne),o[0].affectedFiles?A?(A.p(o,p),p&1&&E(A,1)):(A=Se(o),A.c(),E(A,1),A.m(le.parentNode,le)):A&&(me(),N(A,1,1,()=>{A=null}),pe()),p&1){Y=_e(o[0].correspondences);let B;for(B=0;B<Y.length;B+=1){const ee=Ce(o,Y,B);C[B]?(C[B].p(ee,p),E(C[B],1)):(C[B]=ye(ee),C[B].c(),E(C[B],1),C[B].m(se.parentNode,se))}for(me(),B=Y.length;B<C.length;B+=1)Ue(B);pe()}const fe={};p&262157&&(fe.$$scope={dirty:p,ctx:o}),X.$set(fe)},i(o){if(!Q){E(l.$$.fragment,o),E(g.$$.fragment,o),E(I.$$.fragment,o),E($.$$.fragment,o),E(W.$$.fragment,o),E(A);for(let p=0;p<Y.length;p+=1)E(C[p]);E(X.$$.fragment,o),Q=!0}},o(o){N(l.$$.fragment,o),N(g.$$.fragment,o),N(I.$$.fragment,o),N($.$$.fragment,o),N(W.$$.fragment,o),N(A),C=C.filter(Boolean);for(let p=0;p<C.length;p+=1)N(C[p]);N(X.$$.fragment,o),Q=!1},d(o){o&&(d(e),d(z),d(q),d(de),d(le),d(se)),F(l),F(g),F(I),F($),F(W),A&&A.d(o),Pe(C,o),F(X,o)}}}function it(r){let e,t;return e=new Ke({props:{class:"overflow-y-auto",$$slots:{default:[ot]},$$scope:{ctx:r}}}),{c(){M(e.$$.fragment)},l(l){L(e.$$.fragment,l)},m(l,f){U(e,l,f),t=!0},p(l,f){const s={};f&262157&&(s.$$scope={dirty:f,ctx:l}),e.$set(s)},i(l){t||(E(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function ft(r){let e,t,l;function f(a){r[9](a)}let s={$$slots:{default:[it]},$$scope:{ctx:r}};return r[1]!==void 0&&(s.open=r[1]),e=new Je({props:s}),Ae.push(()=>Be(e,"open",f)),{c(){M(e.$$.fragment)},l(a){L(e.$$.fragment,a)},m(a,n){U(e,a,n),l=!0},p(a,[n]){const i={};n&262157&&(i.$$scope={dirty:n,ctx:a}),!t&&n&2&&(t=!0,i.open=a[1],je(()=>t=!1)),e.$set(i)},i(a){l||(E(e.$$.fragment,a),l=!0)},o(a){N(e.$$.fragment,a),l=!1},d(a){F(e,a)}}}function ct(r){let e="";const t=new Uint8Array(r),l=t.byteLength;for(let f=0;f<l;f++)e+=String.fromCharCode(t[f]);return window.btoa(e)}function ut(r){return new Promise((e,t)=>{const l=new FileReader;l.onload=()=>e(l.result),l.onerror=t,l.readAsArrayBuffer(r)}).then(e=>new Uint8Array(e))}function dt(r,e,t){let l;Me(r,Ge,c=>t(11,l=c));let{data:f}=e,{open:s=!1}=e,a="",n=null,i=!1;async function _(){t(3,i=!0);let c=null;n&&(c=await(await fetch(`${Ee}/api/files/uploadAttachment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([{fileName:n.name,Name:"",contentType:n.type,data:ct(await ut(n))}])})).json());let $=await fetch(`${Ee}/api/tickets/AddMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ticketId:f.id,newStatus:l.id===f.creatorId?ge.awaitingStaff:ge.awaitingUser,correspondence:c!==null?{message:a,attachment:c[0],senderId:l.id,senderName:l.name}:{message:a,senderId:l.id,senderName:l.name}})});if($.ok){const m=await $.json();t(0,f=m)}t(3,i=!1),t(2,a=""),n=null}async function u(c){const $=c==null?void 0:c.target;if($.files){if($.files.length>1){Te.error("maximum of 1 images",{position:"top-right"});return}for(let m=0;m<$.files.length;m++)if($.files[m].size>5e6){Te.error("maximum file size of 5MB exceeded",{position:"top-right"});return}for(let m=0;m<$.files.length;m++)n=$.files[0]}}function g(c){a=c,t(2,a)}const V=c=>u(c),I=()=>_();function T(c){s=c,t(1,s)}return r.$$set=c=>{"data"in c&&t(0,f=c.data),"open"in c&&t(1,s=c.open)},[f,s,a,i,_,u,g,V,I,T]}class yt extends Re{constructor(e){super(),qe(this,e,dt,ft,Le,{data:0,open:1})}}export{yt as default};
