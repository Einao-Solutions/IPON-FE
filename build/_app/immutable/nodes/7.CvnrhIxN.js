import{s as Q,d as y,i as P,b as U,o as W,c as I,e as N,g as q,A as K,h as T,j,k as V,p as X,n as O,f as Y,t as Z,q as M,u as ee,r as te,v as se,B as v}from"../chunks/qLIpCCSV.js";import{S as ne,i as oe,d as H,t as w,a as A,c as ae,m as B,e as D,f as J,g as le}from"../chunks/Bpqo0lwe.js";import{I as ie}from"../chunks/DxaiNGYP.js";import"../chunks/B7ETfSbN.js";import{h as F,i as E,f as R,l as x,j as re,k as ce,m as fe,a as L,o as ue}from"../chunks/WlDbmOKK.js";import{A as k,U as C}from"../chunks/DvhB1z8p.js";import{g as z}from"../chunks/sTQiEMwh.js";import{p as me}from"../chunks/4srO1X8Q.js";import{B as G}from"../chunks/Amalccm3.js";function pe(r){let e,n;return e=new ie({props:{icon:"openmoji:return",width:"1.2rem",height:"1.2rem"}}),{c(){J(e.$$.fragment)},l(s){D(e.$$.fragment,s)},m(s,a){B(e,s,a),n=!0},p:O,i(s){n||(A(e.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),n=!1},d(s){H(e,s)}}}function _e(r){let e;return{c(){e=Z("Home")},l(n){e=Y(n,"Home")},m(n,s){P(n,e,s)},d(n){n&&y(e)}}}function ge(r){let e;const n=r[1].default,s=M(n,r,r[4],null);return{c(){s&&s.c()},l(a){s&&s.l(a)},m(a,_){s&&s.m(a,_),e=!0},p(a,_){s&&s.p&&(!e||_&16)&&ee(s,n,a,a[4],e?se(n,a[4],_,null):te(a[4]),null)},i(a){e||(A(s,a),e=!0)},o(a){w(s,a),e=!1},d(a){s&&s.d(a)}}}function de(r){let e,n="loading......";return{c(){e=T("p"),e.textContent=n},l(s){e=I(s,"P",{"data-svelte-h":!0}),K(e)!=="svelte-15ifni0"&&(e.textContent=n)},m(s,a){P(s,e,a)},p:O,i:O,o:O,d(s){s&&y(e)}}}function he(r){let e,n,s,a,_="Revisions Made",S,f,b,g,u,i,c;n=new G({props:{size:"icon",variant:"outline",$$slots:{default:[pe]},$$scope:{ctx:r}}}),n.$on("click",r[2]),f=new G({props:{$$slots:{default:[_e]},$$scope:{ctx:r}}}),f.$on("click",r[3]);const d=[de,ge],t=[];function m(l,o){return l[0]?0:1}return u=m(r),i=t[u]=d[u](r),{c(){e=T("div"),J(n.$$.fragment),s=j(),a=T("p"),a.textContent=_,S=j(),J(f.$$.fragment),b=j(),g=T("div"),i.c(),this.h()},l(l){e=I(l,"DIV",{class:!0});var o=N(e);D(n.$$.fragment,o),s=q(o),a=I(o,"P",{"data-svelte-h":!0}),K(a)!=="svelte-1f900u1"&&(a.textContent=_),S=q(o),D(f.$$.fragment,o),o.forEach(y),b=q(l),g=I(l,"DIV",{});var h=N(g);i.l(h),h.forEach(y),this.h()},h(){W(e,"class","flex items-center px-2 py-2 justify-between")},m(l,o){P(l,e,o),B(n,e,null),U(e,s),U(e,a),U(e,S),B(f,e,null),P(l,b,o),P(l,g,o),t[u].m(g,null),c=!0},p(l,[o]){const h={};o&16&&(h.$$scope={dirty:o,ctx:l}),n.$set(h);const p={};o&16&&(p.$$scope={dirty:o,ctx:l}),f.$set(p);let $=u;u=m(l),u===$?t[u].p(l,o):(le(),w(t[$],1,1,()=>{t[$]=null}),ae(),i=t[u],i?i.p(l,o):(i=t[u]=d[u](l),i.c()),A(i,1),i.m(g,null))},i(l){c||(A(n.$$.fragment,l),A(f.$$.fragment,l),A(i),c=!0)},o(l){w(n.$$.fragment,l),w(f.$$.fragment,l),w(i),c=!1},d(l){l&&(y(e),y(b),y(g)),H(n),H(f),t[u].d()}}}function $e(r,e,n){let s,a;V(r,me,i=>n(6,s=i)),V(r,x,i=>n(7,a=i));let{$$slots:_={},$$scope:S}=e,f=!0;function b(){n(0,f=!0);const i=v(re);if(i===1||i===null)if(localStorage.getItem("revisions")===null){const d=v(ce);if(d){const t=[],m=[],l=v(fe),o=v(L);d.forEach(p=>{let $=!1;[k.AwaitingPayment,k.AwaitingSearch,k.FormalityFail,k.Re_conduct].includes(o==null?void 0:o.fileStatus)==!1?((o==null?void 0:o.fieldStatus[p])==null||(o==null?void 0:o.fieldStatus[p])==0)&&($=!0):$=!1,t.push({id:crypto.randomUUID(),oldTitle:o[p],newTitle:l[p],status:$?k.AwaitingSave:k.AwaitingConfirmation,dateTime:Date.now(),field:p,statusHistory:[]}),m.push({type:p,payment:$})});const h={fileData:o,data:t,requiresPayment:m,canPassFormality:!1,canPassApproval:!1,isStaffOrAdmin:!1,isUserOrAdmin:!0};localStorage.setItem("revisions",JSON.stringify(h)),n(0,f=!1);return}else F.set({fileData:null,data:null,requiresPayment:null,canPassFormality:!1,canPassApproval:!1})}else{n(0,f=!1);return}else if(i===3){const c=v(L);let d=!1;const t=v(ue),m=v(x),l=(m==null?void 0:m.roles.includes(C.Support))||(m==null?void 0:m.roles.includes(C.BackOffice));[0,11,12].includes(c==null?void 0:c.fileStatus)?((c==null?void 0:c.fieldStatus[t==null?void 0:t.fieldToChange])==null||(c==null?void 0:c.fieldStatus[t==null?void 0:t.fieldToChange])==0)&&(d=!0):d=!1;const o={id:t==null?void 0:t.id,status:t==null?void 0:t.currentStatus,statusHistory:t==null?void 0:t.statusHistory,field:t==null?void 0:t.fieldToChange,newTitle:JSON.parse(t==null?void 0:t.newValue),oldTitle:JSON.parse(t==null?void 0:t.oldValue),dateTime:t==null?void 0:t.applicationDate};n(0,f=!1);const h={fileData:c,data:[o],requiresPayment:[d],canPassFormality:!1,canPassApproval:!1,isStaffOrAdmin:l,isUserOrAdmin:[C.Support,C.Agent].some(p=>a.roles.includes(p))};localStorage.setItem("revisions",JSON.stringify(h))}}X(()=>{b(),s.url.searchParams.get("id")});const g=async()=>{F.set({}),E.set(null),R.set([]),await z("/home/dashboard")},u=()=>{F.set({}),E.set(null),R.set([]),z("/home/dashboard")};return r.$$set=i=>{"$$scope"in i&&n(4,S=i.$$scope)},[f,_,g,u,S]}class Ie extends ne{constructor(e){super(),oe(this,e,$e,he,Q,{})}}export{Ie as component};
