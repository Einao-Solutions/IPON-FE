import{S as Q,i as W,s as X,d as y,p as R,q as A,r as k,v as Y,b as P,w as D,c as O,x as Z,e as T,f as J,y as H,h as q,K as G,j as I,z as E,k as j,l as N,A as M,n as U,g as ee,t as te,B as se,C as ne,D as ae,E as oe,L as v,F as le}from"../chunks/Cccy056x.js";import"../chunks/IHki7fMi.js";import{I as ie}from"../chunks/DQ1KgJGZ.js";import"../chunks/Mi5ChQ-_.js";import{h as F,i as V,f as x,l as B,j as re,k as ce,m as fe,a as L,o as ue}from"../chunks/CuoJv0KR.js";import{A as w,U as C}from"../chunks/CHHWQs5a.js";import{g as z}from"../chunks/D8-1Jbz4.js";import{p as me}from"../chunks/Dww-D-F2.js";import{B as K}from"../chunks/BCzZLC02.js";function pe(r){let e,n;return e=new ie({props:{icon:"openmoji:return",width:"1.2rem",height:"1.2rem"}}),{c(){E(e.$$.fragment)},l(s){H(e.$$.fragment,s)},m(s,o){D(e,s,o),n=!0},p:U,i(s){n||(k(e.$$.fragment,s),n=!0)},o(s){A(e.$$.fragment,s),n=!1},d(s){R(e,s)}}}function _e(r){let e;return{c(){e=te("Home")},l(n){e=ee(n,"Home")},m(n,s){P(n,e,s)},d(n){n&&y(e)}}}function ge(r){let e;const n=r[1].default,s=se(n,r,r[4],null);return{c(){s&&s.c()},l(o){s&&s.l(o)},m(o,_){s&&s.m(o,_),e=!0},p(o,_){s&&s.p&&(!e||_&16)&&ne(s,n,o,o[4],e?oe(n,o[4],_,null):ae(o[4]),null)},i(o){e||(k(s,o),e=!0)},o(o){A(s,o),e=!1},d(o){s&&s.d(o)}}}function de(r){let e,n="loading......";return{c(){e=I("p"),e.textContent=n},l(s){e=T(s,"P",{"data-svelte-h":!0}),G(e)!=="svelte-15ifni0"&&(e.textContent=n)},m(s,o){P(s,e,o)},p:U,i:U,o:U,d(s){s&&y(e)}}}function he(r){let e,n,s,o,_="Revisions Made",S,f,b,g,u,i,c;n=new K({props:{size:"icon",variant:"outline",$$slots:{default:[pe]},$$scope:{ctx:r}}}),n.$on("click",r[2]),f=new K({props:{$$slots:{default:[_e]},$$scope:{ctx:r}}}),f.$on("click",r[3]);const d=[de,ge],t=[];function m(l,a){return l[0]?0:1}return u=m(r),i=t[u]=d[u](r),{c(){e=I("div"),E(n.$$.fragment),s=j(),o=I("p"),o.textContent=_,S=j(),E(f.$$.fragment),b=j(),g=I("div"),i.c(),this.h()},l(l){e=T(l,"DIV",{class:!0});var a=J(e);H(n.$$.fragment,a),s=q(a),o=T(a,"P",{"data-svelte-h":!0}),G(o)!=="svelte-1f900u1"&&(o.textContent=_),S=q(a),H(f.$$.fragment,a),a.forEach(y),b=q(l),g=T(l,"DIV",{});var h=J(g);i.l(h),h.forEach(y),this.h()},h(){Z(e,"class","flex items-center px-2 py-2 justify-between")},m(l,a){P(l,e,a),D(n,e,null),O(e,s),O(e,o),O(e,S),D(f,e,null),P(l,b,a),P(l,g,a),t[u].m(g,null),c=!0},p(l,[a]){const h={};a&16&&(h.$$scope={dirty:a,ctx:l}),n.$set(h);const p={};a&16&&(p.$$scope={dirty:a,ctx:l}),f.$set(p);let $=u;u=m(l),u===$?t[u].p(l,a):(le(),A(t[$],1,1,()=>{t[$]=null}),Y(),i=t[u],i?i.p(l,a):(i=t[u]=d[u](l),i.c()),k(i,1),i.m(g,null))},i(l){c||(k(n.$$.fragment,l),k(f.$$.fragment,l),k(i),c=!0)},o(l){A(n.$$.fragment,l),A(f.$$.fragment,l),A(i),c=!1},d(l){l&&(y(e),y(b),y(g)),R(n),R(f),t[u].d()}}}function $e(r,e,n){let s,o;N(r,me,i=>n(6,s=i)),N(r,B,i=>n(7,o=i));let{$$slots:_={},$$scope:S}=e,f=!0;function b(){n(0,f=!0);const i=v(re);if(i===1||i===null)if(localStorage.getItem("revisions")===null){const d=v(ce);if(d){const t=[],m=[],l=v(fe),a=v(L);d.forEach(p=>{let $=!1;[w.AwaitingPayment,w.AwaitingSearch,w.FormalityFail,w.Re_conduct].includes(a==null?void 0:a.fileStatus)==!1?((a==null?void 0:a.fieldStatus[p])==null||(a==null?void 0:a.fieldStatus[p])==0)&&($=!0):$=!1,t.push({id:crypto.randomUUID(),oldTitle:a[p],newTitle:l[p],status:$?w.AwaitingSave:w.AwaitingConfirmation,dateTime:Date.now(),field:p,statusHistory:[]}),m.push({type:p,payment:$})});const h={fileData:a,data:t,requiresPayment:m,canPassFormality:!1,canPassApproval:!1,isStaffOrAdmin:!1,isUserOrAdmin:!0};localStorage.setItem("revisions",JSON.stringify(h)),n(0,f=!1);return}else F.set({fileData:null,data:null,requiresPayment:null,canPassFormality:!1,canPassApproval:!1})}else{n(0,f=!1);return}else if(i===3){const c=v(L);let d=!1;const t=v(ue),m=v(B),l=(m==null?void 0:m.userRoles.includes(C.Tech))||(m==null?void 0:m.userRoles.includes(C.SuperAdmin));[0,11,12].includes(c==null?void 0:c.fileStatus)?((c==null?void 0:c.fieldStatus[t==null?void 0:t.fieldToChange])==null||(c==null?void 0:c.fieldStatus[t==null?void 0:t.fieldToChange])==0)&&(d=!0):d=!1;const a={id:t==null?void 0:t.id,status:t==null?void 0:t.currentStatus,statusHistory:t==null?void 0:t.statusHistory,field:t==null?void 0:t.fieldToChange,newTitle:JSON.parse(t==null?void 0:t.newValue),oldTitle:JSON.parse(t==null?void 0:t.oldValue),dateTime:t==null?void 0:t.applicationDate};n(0,f=!1);const h={fileData:c,data:[a],requiresPayment:[d],canPassFormality:!1,canPassApproval:!1,isStaffOrAdmin:l,isUserOrAdmin:[C.Tech,C.Agent].some(p=>o.userRoles.includes(p))};localStorage.setItem("revisions",JSON.stringify(h))}}M(()=>{b(),s.url.searchParams.get("id")});const g=async()=>{F.set({}),V.set(null),x.set([]),await z("/home/dashboard")},u=()=>{F.set({}),V.set(null),x.set([]),z("/home/dashboard")};return r.$$set=i=>{"$$scope"in i&&n(4,S=i.$$scope)},[f,_,g,u,S]}class Te extends Q{constructor(e){super(),W(this,e,$e,he,X,{})}}export{Te as component};
