<script lang="ts">
	import SideMenu from './SideMenu.svelte';
	import { Input } from '$lib/components/ui/input';
	import BottomNavBar from './BottomNavBar.svelte';
	import { loggedInUser } from '$lib/store';
	import { onMount } from 'svelte';
	import type { LayoutServerData } from '../../../.svelte-kit/types/src/routes/home/$types';
	import { Button } from '$lib/components/ui/button';
	import FilterFile from './FilterFile.svelte';
	import { goto } from '$app/navigation';
	import { baseURL } from '$lib/helpers';
	$: userName="";
	export let data:LayoutServerData;
	let filterFiles:FilterFile|null=null;
	let showFilterSheet:boolean=false;
	let searchTitle:string|null=null;

	loggedInUser.subscribe((user)=>{
		userName = user?.name;
	})
	onMount(async ()=>{
		var cookieUser=document.cookie.split(';').find(x=>x.startsWith("user=") || x.startsWith(" user="))
		if(!cookieUser){
			goto("/auth")
		}
		else {

		}
	})
	let filterData={};

	// async function advancedSearch()
	// {
	// 	if (filterFiles === null) {
	// 		filterFiles = (await import('./FilterFile.svelte')).default;
	// 		const handleClose = () => {
	// 			showFilterSheet = false;
	// 		};
	// 		filterData={
	// 			open:true,
	// 			onclose:handleClose,
	// 		}
	// 	}
	// 	showFilterSheet=true;
	// }
</script>

{#if showFilterSheet}
	<svelte:component this={filterFiles} {...filterData} />
{/if}
<div class="flex h-screen p-1 sm:p-4 w-full  ">
	<nav class="hidden sm:block backdrop-blur-sm bg-gray-100 rounded-md fixed h-[calc(100vh-2rem)]">
		<SideMenu />
	</nav>
	<div class="sm:ml-56 w-full flex flex-col">
		<div class="items-center mx-4 sm:justify-between flex rounded-md bg-gray-100 p-2">
			<Input placeholder="Search by title, file number or applicant name" bind:value={searchTitle} type="search" class="w-[320px]"
						 on:keypress ={(event)=>{if(event.key==='Enter')goto(`/files?title=${searchTitle}`)}} />
			<p class="hidden sm:inline">{userName}</p>
		</div>
		<br />
		<div class="px-5">
		<slot  />
		</div>
		<nav class="sm:hidden fixed bottom-0 left-0 right-0 z-10 backdrop-blur-sm bg-white/30">
			<div class="flex items-end justify-evenly h-14">
				<BottomNavBar />
			</div>
		</nav>
	</div>
</div>